<!-- HEADY_BRAND:BEGIN -->
<!-- ╔══════════════════════════════════════════════════════════════════╗ -->
<!-- ║  ██╗  ██╗███████╗ █████╗ ██████╗ ██╗   ██╗                     ║ -->
<!-- ║  ██║  ██║██╔════╝██╔══██╗██╔══██╗╚██╗ ██╔╝                     ║ -->
<!-- ║  ███████║█████╗  ███████║██║  ██║ ╚████╔╝                      ║ -->
<!-- ║  ██╔══██║██╔══╝  ██╔══██║██║  ██║  ╚██╔╝                       ║ -->
<!-- ║  ██║  ██║███████╗██║  ██║██████╔╝   ██║                        ║ -->
<!-- ║  ╚═╝  ╚═╝╚══════╝╚═╝  ╚═╝╚═════╝    ╚═╝                        ║ -->
<!-- ║                                                                  ║ -->
<!-- ║  ∞ SACRED GEOMETRY ∞  Organic Systems · Breathing Interfaces    ║ -->
<!-- ║  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  ║ -->
<!-- ║  FILE: .github/copilot-instructions.md                          ║ -->
<!-- ║  LAYER: root                                                    ║ -->
<!-- ╚══════════════════════════════════════════════════════════════════╝ -->
<!-- HEADY_BRAND:END -->
# Heady Systems - GitHub Copilot Instructions

## SYSTEM STATUS: 100% FULLY FUNCTIONAL

**HeadyCloud is live and operational** with complete auto-deployment, persistent memory, and 100% HeadyBrain dominance.

## Primary Directive
You are working with the Heady Systems ecosystem - an AI-native platform built on Sacred Geometry architecture with organic, breathing interfaces. This system is **100% fully functional** and designed from the ground up for AI collaboration.

## Current System State
- **HeadyCloud Platform**: Live at https://headysystems.com
- **HeadyBrain Dominance**: 100% enforcement active
- **Persistent Memory**: Full integration complete
- **Auto-Deploy Pipeline**: Active and optimized
- **Performance**: EXCELLENT (91.39 Monte Carlo score)

## Core Architecture Principles

### Sacred Geometry Design
- All components follow geometric patterns and mathematical relationships
- Organic, breathing interfaces that feel alive and responsive
- Systems designed for AI collaboration, not retrofitting
- Built-in hooks, contexts, and feedback loops

### AI-Native Foundation
- Systems speak the same language as AI agents
- Monte Carlo optimization and pattern recognition engines
- HeadyLayer switcher for multi-environment deployment
- Comprehensive checkpoint sync protocol
- **Persistent Memory System**: Deep data scanning with pre-execution optimization

### Key Components (100% Operational)
- **HeadyManager**: Node.js orchestrator (port 3300) - LIVE
- **HeadyBuddy**: Desktop overlay task assistant - DEPLOYED
- **HeadyLens**: Monitoring and observability layer - ACTIVE
- **Monte Carlo Scheduler**: UCB1-based plan selection - OPTIMIZED
- **Pattern Engine**: Performance and reliability pattern recognition - LEARNING
- **Persistent Memory**: Deep data integration system - ACTIVE

## Development Workflow

### HCFP (HeadyConnection Full Pipeline)
Always operate in HCFP mode:
1. **Errors**: Fix root causes, not symptoms
2. **Improvements**: Quality, structure, docs, UX
3. **Organization**: File system and archive management
4. **Deployment**: Clean, production-ready releases
5. **Memory**: Pre-execution scanning for optimal context

### Auto-Deployment Protocol
- **Cloud-First**: All deployments go to HeadyCloud
- **Production Gate**: 100% compliance required
- **Zero-Downtime**: Continuous deployment
- **Auto-Recovery**: Automatic rollback on failure
- **Performance Monitoring**: Real-time optimization
### Dark Mode Implementation
- All UI components support dark/light themes
- Proper contrast ratios for accessibility
- CSS variables for theme switching
- Semantic color usage

### React Components
- Functional components with hooks
- Tailwind CSS for styling
- Sacred geometry aesthetics (rounded, organic)
- Living orb headers and breathing animations

### API Design
- RESTful endpoints with clear naming
- Structured logging with correlation IDs
- Health checks and monitoring hooks
- Environment-aware configuration

## Deployment Strategy

### Multi-Layer Architecture
- `local` - Development (app.headysystems.com:3300)
- `cloud-me` - HeadyMe cloud instance
- `cloud-sys` - HeadySystems cloud instance  
- `cloud-conn` - HeadyConnection cloud instance
- `hybrid` - Mixed environment

### CI/CD Pipeline
- Clean builds on every change
- Automated testing and security scanning
- Error classification (recoverable vs non-recoverable)
- Blue-green deployment strategy

## Mobile & Cross-Device
- Responsive design for all screen sizes
- Touch-friendly interfaces
- Cross-platform compatibility
- Performance optimization for mobile networks

## Security & Privacy
- No hardcoded secrets
- Environment-based configuration
- Structured error messages (no sensitive data)
- Regular security audits

## Documentation Standards
- Living documents that stay in sync
- Clear ownership and review cycles
- API documentation with examples
- Architecture diagrams and decision records

## Testing Philosophy
- Unit tests for core logic
- Integration tests for component interactions
- E2E tests for critical user flows
- Performance tests for scalability

## Monitoring & Observability
- Structured logging with timestamps
- Metrics collection and alerting
- Health check endpoints
- Performance dashboards

## When in Doubt
1. Check the heady-registry.json for component locations
2. Run checkpoint sync to validate system state
3. Follow HCFP principles for systematic improvement
4. Maintain the Sacred Geometry aesthetic in all interfaces
5. Keep everything AI-native and collaboration-ready

## Patented Concepts
This system incorporates "patented Sacred Geometry architecture" - ensure all implementations respect this foundational principle.
## Version Control & Change Management
- Meaningful commit messages following conventional commits format (`feat:`, `fix:`, `docs:`, `chore:`, `refactor:`, `test:`, `perf:`, `ci:`, `build:`, `style:`)
- Automated changelog generation via semantic-release with GitHub releases
- Branch protection rules enforced on main/production branches with status checks
- Pull request templates with checklist validation and auto-labeling
- Squash merging for clean history with PR title as commit message
- Branch naming convention: `feature/`, `fix/`, `hotfix/`, `release/`, `docs/`, `chore/`, `refactor/`
- Required reviewers: minimum 1 for features, 2 for production changes, CODEOWNERS enforcement
- Stale branch cleanup after 30 days of inactivity
- Protected tag patterns for release versions (`v*.*.*`)

## Error Prevention & Resolution
- Pre-commit hooks for linting, formatting, and type checking via Husky
- TypeScript strict mode enabled with `noImplicitAny`, `strictNullChecks`, `noUnusedLocals`, `noUnusedParameters`, `exactOptionalPropertyTypes`, `noUncheckedIndexedAccess`
- ESLint with Heady-specific rules and auto-fix on save (extends `@heady/eslint-config`)
- Prettier for consistent code formatting (2-space indentation, single quotes, trailing commas)
- Husky + lint-staged for staged file validation with parallel execution
- EditorConfig for cross-IDE consistency (`.editorconfig` in root)
- Spell checking via cspell for documentation, comments, and string literals
- Commitlint for commit message validation
- Import sorting via `eslint-plugin-import` with Heady-specific groups
- Dead code detection via `ts-prune` and `knip`

## File Maintenance Protocol (FMSAP)
- Weekly automated scans (Layers 1-4) via `file_maintenance.yml` (Sundays 02:00 UTC)
- Pre-scan validation checks (`pre_scan_check.ps1` / `pre_scan_check.sh`)
- Issue creation from scan results with severity labels (`critical`, `high`, `medium`, `low`, `info`)
- Automated commit of scan updates with `[FMSAP]` prefix and scan timestamp
- Orphan file detection and archival recommendations with auto-archive option
- Documentation freshness validation (stale after 90 days, warning at 60 days)
- Duplicate file detection and consolidation recommendations via content hashing
- Dead code analysis and removal suggestions with confidence scores
- License file validation and compliance checking
- Large file detection (>1MB warning, >10MB error)
- Binary file tracking and LFS migration recommendations

## Environment Configuration
- Use `.env.local` for local development (never committed, gitignored)
- Use `.env.example` as template with production-appropriate defaults and descriptions
- Never commit `.env` files with secrets (enforced via pre-commit hook)
- Reference `service-discovery.yaml` for domain configuration and service endpoints
- Banned patterns: `localhost`, `127.0.0.1`, `0.0.0.0`, cloud provider subdomains (validated by CI)
- All secrets managed via GitHub Secrets or cloud provider vaults (AWS Secrets Manager, Azure Key Vault)
- Environment validation on application startup with clear error messages
- Required environment variables documented in `.env.example` with descriptions and types
- Environment variable naming: `HEADY_` prefix for app-specific, `NODE_` for Node.js, `CI_` for CI/CD
- Dotenv validation schema via `zod` or `joi`
- Secret rotation reminders via GitHub Actions scheduled workflow

## URL & Domain Standards
- **Production Domains**: 
  - `headysystems.com` (primary platform)
  - `headyconnection.org` (community/connection services)
  - `headybuddy.org` (assistant services)
- **Subdomains**: `api.`, `app.`, `www.`, `cdn.`, `assets.`, `static.`, `mail.`, `docs.`, `status.`, `admin.`, `dev.`, `staging.`
- No direct cloud provider URLs (`.onrender.com`, `.vercel.app`, `.netlify.app`, `.herokuapp.com`, `.firebaseapp.com`, `.azurewebsites.net`, `.cloudflare.dev`)
- Environment variables for all external URLs with validation
- Fallback URLs must be production-appropriate (validated by `localhost-validation.yml`)
- OAuth callbacks must use proper domains (e.g., `https://app.headysystems.com/oauth/callback`)
- CORS configuration restricted to approved domains only with wildcard subdomain support
- DNS validation for new subdomains before deployment
- SSL certificate monitoring with 30-day expiry alerts

## Proto/gRPC Services (Android SDK)
- **EmulatorController**: Device control and interaction
- **SnapshotService**: State management and recovery
- **AdbService**: Debug bridge integration
- **EmulatedBluetooth**: Bluetooth simulation
- **EmulatorStats**: Runtime metrics and monitoring
- **HeadyBridge**: Custom Heady-to-device communication layer
- **HeadySync**: Real-time data synchronization service
- **HeadyAuth**: Authentication and authorization service
- **HeadyNotification**: Push notification delivery service
- Proto file versioning with backward compatibility requirements (semver)
- gRPC health checking enabled on all services (`grpc.health.v1.Health`)
- Reflection enabled in development for debugging
- Deadline/timeout propagation across service calls
- Interceptors for logging, metrics, and authentication

## Build & CI Best Practices
- Clean builds (no incremental caching for CI) - fresh checkout per job
- Parallel job execution where possible with dependency graphs
- Artifact passing between jobs (not rebuilds) with 1-day retention
- Test sharding for parallel execution across matrix builds (4 shards default)
- Timeout limits on all jobs (default: 30 minutes, max: 60 minutes, tests: 15 minutes)
- Node.js version pinned via `.nvmrc` and `NODE_VERSION` env var (currently v20.11.0 LTS)
- Lock file integrity validation (`npm ci` not `npm install`)
- Build caching for dependencies only (not source artifacts) via GitHub Actions cache
- Matrix builds for cross-platform validation (ubuntu-latest, windows-latest, macos-latest)
- Concurrency limits to prevent resource exhaustion (max 5 parallel workflows)
- Workflow dispatch for manual triggers with input parameters
- Reusable workflows for common patterns (`.github/workflows/reusable-*.yml`)
- Job summaries with test results and coverage reports
- Fail-fast disabled for matrix builds to capture all failures

## Error Classification System
- **Recoverable Errors** (Auto-retry with exponential backoff):
  - Network: `ECONNREFUSED`, `ETIMEDOUT`, `EAI_AGAIN`, `socket hang up`, `ENOTFOUND`, `ECONNRESET`, `EPIPE`
  - Registry: HTTP 502, 503, 504, 429, 408 from npm/GitHub
  - Tests: `flaky`, `random seed`, `race condition`, `intermittent`, `timeout`, `ENOMEM`
  - Database: Connection pool exhaustion, deadlock detection, replication lag
  - External APIs: Rate limiting, temporary unavailability
- **Non-Recoverable Errors** (Fail fast, notify, block deployment):
  - Code compilation errors (TypeScript, Babel)
  - Configuration issues (missing required config)
  - Security vulnerabilities (critical/high level from npm audit)
  - Type errors and lint failures (ESLint errors, not warnings)
  - Missing required environment variables
  - Schema validation failures
  - Authentication/authorization failures
- Retry configuration: 3 attempts with exponential backoff (30s, 60s, 120s)
- Circuit breaker pattern for external service calls (5 failures = open, 30s reset)
- Bulkhead pattern for resource isolation

## Performance Optimization
- Monte Carlo UCB1-based plan selection (91.39 score baseline, target: 95+)
- Pattern recognition for reliability improvements via PatternEngine
- Lazy loading for non-critical components with Suspense boundaries
- Asset optimization and CDN delivery via `cdn.headysystems.com` with edge caching
- Tree shaking and code splitting enabled (route-based and component-based)
- Image optimization with WebP/AVIF formats (fallback to PNG/JPEG, srcset for responsive)
- Service worker caching for offline capability with stale-while-revalidate
- Database query optimization with index analysis and query planning
- Connection pooling for database (min: 5, max: 20) and external services
- Response compression (gzip/brotli) enabled with minimum size threshold (1KB)
- HTTP/2 and HTTP/3 support where available with server push
- Prefetching for likely next navigations
- Bundle size monitoring with size-limit (max 250KB gzipped for main bundle)
- Memory leak detection in development mode
- React.memo and useMemo for expensive computations
- Virtual scrolling for large lists (>100 items)

## Accessibility Requirements
- WCAG 2.1 AA compliance minimum (AAA for critical flows like authentication, payments)
- Keyboard navigation support with visible focus indicators (2px solid outline)
- Screen reader compatibility with ARIA labels, live regions, and announcements
- Color contrast validation (4.5:1 minimum for text, 3:1 for large text, 3:1 for UI components)
- Reduced motion support via `prefers-reduced-motion` with graceful degradation
- Focus trap management for modals, overlays, and drawers
- Skip navigation links for main content and repeated blocks
- Form validation with accessible error messages and `aria-describedby`
- Alternative text for all images and media (decorative images use `alt=""`)
- Semantic HTML structure with proper heading hierarchy (no skipped levels)
- Touch target minimum 44x44px with adequate spacing
- High contrast mode support via `forced-colors` media query
- Accessible data tables with proper headers and scope
- Time limits with user control (extend, disable)
- Error prevention for critical actions (confirmation dialogs)

## Security Best Practices
- `npm audit` with moderate severity threshold (high/critical = fail)
- TruffleHog secret scanning on all PRs with baseline exclusions
- Dependency vulnerability monitoring via Dependabot (weekly updates, auto-merge for patch)
- Content Security Policy headers

---
*Last updated: 2026-02-08*
*System: HeadyConnection Full Pipeline v3.2.0*





